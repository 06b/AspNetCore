# Don't run CI for this config yet. We're not ready to move official builds on to Azure Pipelines
trigger: none

# Run PR validation on all branches
pr:
  branches:
    include:
    - '*'

jobs:
- template: jobs/default-build.yml
  parameters:
    jobName: Helix_x64
    jobDisplayName: 'Tests: Helix x64'
    agentOs: Windows
    timeoutInMinutes: 240
    steps:
    - script: .\build.cmd -all -ci /p:BuildNative=true /t:Helix /p:IsHelixJob=true /bl:$env:BUILD_SOURCESDIRECTORY\artifacts\log\SendToHelix.binlog
      displayName: Run build.cmd helix target
      env:
        SYSTEM_ACCESSTOKEN: $(System.AccessToken) # We need to set this env var to publish helix results to Azure Dev Ops
    artifacts:
    - name: Helix_logs
      path: artifacts/log/
      publishOnError: true

# Build Helix ARM64
- template: jobs/default-build.yml
  parameters:
    jobName: Helix_arm64
    jobDisplayName: "Tests: Helix ARM64"
    agentOs: Linux
    timeoutInMinutes: 240
    steps:
    - script: ./eng/scripts/cibuild.sh --arch arm64 --no-build-nodejs --no-build-java /t:Helix /p:IsHelixJob=true /bl:$env:BUILD_SOURCESDIRECTORY\artifacts\logs\SendToHelixArm64.binlog
      displayName: Run cibuild.sh -arch arm64 helix target
      env:
        SYSTEM_ACCESSTOKEN: $(System.AccessToken) # We need to set this env var to publish helix results to Azure Dev Ops
    installNodeJs: false
    artifacts:
    - name: Helix_arm64_logs
      path: artifacts/logs/
      publishOnError: true
